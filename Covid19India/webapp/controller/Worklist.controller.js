sap.ui.define(["com/sap/dinesh/covid19india/dashboard/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/Device","sap/base/util/deepClone"],function(e,t,o,i,n,s,r){"use strict";return e.extend("com.sap.dinesh.covid19india.dashboard.controller.Worklist",{onInit:function(){this.getRouter().getRoute("worklist").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(){this.getView().getModel("appView").setProperty("/busy",!0),this.getView().setBusy(!0),this.getData(),this.modelServices(),this.checkConnection()||this.getRouter().getTargets().display("notFound")},onAfterRendering:function(){this.getView().getModel("appView").setProperty("/busy",!0),s.support.touch?this.getView().byId("Tilecontainer").setHeight("100%"):this.getView().byId("Tilecontainer").setHeight("50%")},modelServices:function(){var e=this;e.intervalHandle=setInterval(function(){e.getData()},12e5)},getData:function(){var e=this,o=[],i=[],n=[],s=[],a=0,l=0,u=[],p=[],c={flag:"images/global.png"},d="",h=new t(e.getOwnerComponent().getModel("flagdata").getData());this.getView().setModel(h,"flag");var g=new t;g.setSizeLimit(1e3),g.attachRequestCompleted(function(h){o=h.getSource().getData();var g=new t;g.setSizeLimit(1e3),g.attachRequestCompleted(function(h){d=h.getSource().getData();var g=new t(d);if(this.getView().setModel(g),d.statewise&&(p=d.statewise.filter(function(e){return"Total"===e.state})),o.length){var f=o.filter(function(e){return"World"===e.country||"Global"===e.country}),v=new t(f);e.getView().setModel(v,"GlobalData")}if(o.length>0){i=e.getOwnerComponent().getModel("flagdata").getData();for(var w=0;w<o.length;w++)if(a+=Number(o[w].totalTests),l+=Number(o[w].testsPerOneMillion),i.length){for(var m=!1,y=0;y<i.length;y++)i[y].country===o[w].country&&(o[w].countryInfo=i[y].countryInfo,m=!0);m||(o[w].countryInfo=c),"World"===o[w].country||"Global"===o[w].country?(o[w].country="Global",o[w].countryInfo=c,u.push(o[w])):("India"===o[w].country&&(p.length&&(o[w].recovered=Number(p[0].recovered)),p.length&&(o[w].cases=Number(p[0].confirmed)),p.length&&(o[w].active=Number(p[0].active)),n.push(o[w])),"Total"!==o[w].country&&"Total:"!==o[w].country&&"India"!==o[w].country&&s.push(o[w]))}}u.length&&(u[0].totalTests=a),u.length&&(u[0].testsPerOneMillion=l),n=u.concat(n),s=n.concat(s);var P=new t;P.setData(s),P.setSizeLimit(1e3),e.getView().setModel(P,"CountryData"),e.getOwnerComponent().setModel(P,"CountryData");var _=r(s),b=new t;_.length&&_.sort(function(e,t){return t.cases-e.cases}),b.setData(_),b.setSizeLimit(1e3),e.getView().setModel(b,"CountryDataCases"),this.getView().getModel("appView").setProperty("/busy",!1),this.getView().setBusy(!1)},this).loadData("https://api.covid19india.org/data.json")},this).loadData("https://coronavirus-19-api.herokuapp.com/countries?sort=cases")},onSearch:function(e){var t=[],i=e.getSource().getValue();i&&i.length>0&&(t=[new o("country",sap.ui.model.FilterOperator.Contains,i)]),e.getSource().getParent().getParent().getBinding("items").filter(t,"Application")},onSearchState:function(e){var t=e.getSource().getValue();if(t&&t.length>0)var i=new sap.ui.model.Filter({filters:[new o("state",sap.ui.model.FilterOperator.Contains,t),new o("statecode",sap.ui.model.FilterOperator.Contains,t)]});e.getSource().getParent().getParent().getBinding("items").filter(i,"Application")},onTileDisplayDetails:function(e){this._oPopover?(this._oPopover.bindElement("CountryData>"+e.getSource().oBindingContexts.CountryData.sPath+"/"),this._oPopover.openBy(e.getSource())):(this._oPopover=sap.ui.xmlfragment("com.sap.dinesh.covid19india.dashboard.view.QuickViewCard",this),this.getView().addDependent(this._oPopover),this._oPopover.bindElement("CountryData>"+e.getSource().oBindingContexts.CountryData.sPath+"/"),this._oPopover.openBy(e.getSource()))},handleClosePressed:function(e){this._oPopover.close()},handleClosePressed_oPopoverHelpfulLinks:function(e){this._oPopoverHelpfulLinks.close()},handleCloseMapPressed:function(e){this._oPopoverMap.close()},onExit:function(){this._oPopover&&this._oPopover.destroy(),this._oPopoverHelpfulLinks&&this._oPopoverHelpfulLinks.destroy(),this._oPopoverdIstrictReporting&&this._oPopoverdIstrictReporting.destroy(),this._oPopoverMap&&this._oPopoverMap.destroy()},onHome:function(){window.open("https://indiaagainstcovid19.in/","_self")},dIstrictReporting:function(e){window.open("https://www.mohfw.gov.in/pdf/Districtreporting408.pdf","_blank")},helpLineNumbers:function(e){window.open("https://www.mohfw.gov.in/pdf/coronvavirushelplinenumber.pdf")},helpfulLinks:function(e){this._oPopoverHelpfulLinks?this._oPopoverHelpfulLinks.openBy(e.getSource()):(this._oPopoverHelpfulLinks=sap.ui.xmlfragment("com.sap.dinesh.covid19india.dashboard.view.HelpFullinks",this),this.getView().addDependent(this._oPopoverHelpfulLinks),this._oPopoverHelpfulLinks.openBy(e.getSource()))},openMap:function(e){this.getView().getModel("appView").setProperty("/busy",!0),this.getRouter().navTo("map")}})});
