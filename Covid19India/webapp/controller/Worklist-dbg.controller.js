sap.ui.define(["com/sap/dinesh/covid19india/dashboard/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/Device","sap/base/util/deepClone"],function(e,t,o,n,i,s,r){"use strict";return e.extend("com.sap.dinesh.covid19india.dashboard.controller.Worklist",{onInit:function(){this.getRouter().getRoute("worklist").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(){this.getView().getModel("appView").setProperty("/busy",!0),this.getView().setBusy(!0),this.getData(),this.modelServices(),this.checkConnection()||this.getRouter().getTargets().display("notFound")},onAfterRendering:function(){this.getView().getModel("appView").setProperty("/busy",!0),s.support.touch?this.getView().byId("Tilecontainer").setHeight("100%"):this.getView().byId("Tilecontainer").setHeight("50%")},modelServices:function(){var e=this;e.intervalHandle=setInterval(function(){e.getData()},12e5)},getData:function(){var e=this,o=[],n=[],i=[],s=[],a=0,l=0,p=[],u=[],c={flag:"images/global.png"},d=new t(e.getOwnerComponent().getModel("flagdata").getData());this.getView().setModel(d,"flag");var h=e.getOwnerComponent().getModel("my_global_json_model").getData();h.statewise&&(u=h.statewise.filter(function(e){return"Total"===e.state}));var g=new t;g.setSizeLimit(1e3),g.attachRequestCompleted(function(d){if((o=d.getSource().getData()).length){var h=o.filter(function(e){return"World"===e.country||"Global"===e.country}),g=new t(h);e.getView().setModel(g,"GlobalData")}if(o.length>0){n=e.getOwnerComponent().getModel("flagdata").getData();for(var f=0;f<o.length;f++)if(a+=Number(o[f].totalTests),l+=Number(o[f].testsPerOneMillion),n.length){for(var v=!1,w=0;w<n.length;w++)n[w].country===o[f].country&&(o[f].countryInfo=n[w].countryInfo,v=!0);v||(o[f].countryInfo=c),"World"===o[f].country||"Global"===o[f].country?(o[f].country="Global",o[f].countryInfo=c,p.push(o[f])):("India"===o[f].country&&(u.length&&(o[f].recovered=Number(u[0].recovered)),u.length&&(o[f].cases=Number(u[0].confirmed)),u.length&&(o[f].active=Number(u[0].active)),i.push(o[f])),"Total"!==o[f].country&&"Total:"!==o[f].country&&"India"!==o[f].country&&s.push(o[f]))}}p.length&&(p[0].totalTests=a),p.length&&(p[0].testsPerOneMillion=l),i=p.concat(i),s=i.concat(s);var m=new t;m.setData(s),m.setSizeLimit(1e3),e.getView().setModel(m,"CountryData"),e.getOwnerComponent().setModel(m,"CountryData");var y=r(s),P=new t;y.length&&y.sort(function(e,t){return t.cases-e.cases}),P.setData(y),P.setSizeLimit(1e3),e.getView().setModel(P,"CountryDataCases"),this.getView().getModel("appView").setProperty("/busy",!1),this.getView().setBusy(!1)},this).loadData("https://coronavirus-19-api.herokuapp.com/countries?sort=cases")},onSearch:function(e){var t=[],n=e.getSource().getValue();n&&n.length>0&&(t=[new o("country",sap.ui.model.FilterOperator.Contains,n)]),e.getSource().getParent().getParent().getBinding("items").filter(t,"Application")},onSearchState:function(e){var t=e.getSource().getValue();if(t&&t.length>0)var n=new sap.ui.model.Filter({filters:[new o("state",sap.ui.model.FilterOperator.Contains,t),new o("statecode",sap.ui.model.FilterOperator.Contains,t)]});e.getSource().getParent().getParent().getBinding("items").filter(n,"Application")},onTileDisplayDetails:function(e){this._oPopover?(this._oPopover.bindElement("CountryData>"+e.getSource().oBindingContexts.CountryData.sPath+"/"),this._oPopover.openBy(e.getSource())):(this._oPopover=sap.ui.xmlfragment("com.sap.dinesh.covid19india.dashboard.view.QuickViewCard",this),this.getView().addDependent(this._oPopover),this._oPopover.bindElement("CountryData>"+e.getSource().oBindingContexts.CountryData.sPath+"/"),this._oPopover.openBy(e.getSource()))},handleClosePressed:function(e){this._oPopover.close()},handleClosePressed_oPopoverHelpfulLinks:function(e){this._oPopoverHelpfulLinks.close()},handleCloseMapPressed:function(e){this._oPopoverMap.close()},onExit:function(){this._oPopover&&this._oPopover.destroy(),this._oPopoverHelpfulLinks&&this._oPopoverHelpfulLinks.destroy(),this._oPopoverdIstrictReporting&&this._oPopoverdIstrictReporting.destroy(),this._oPopoverMap&&this._oPopoverMap.destroy()},onHome:function(){window.open("https://indiaagainstcovid19.in/","_self")},dIstrictReporting:function(e){window.open("https://www.mohfw.gov.in/pdf/Districtreporting408.pdf","_blank")},helpLineNumbers:function(e){window.open("https://www.mohfw.gov.in/pdf/coronvavirushelplinenumber.pdf")},helpfulLinks:function(e){this._oPopoverHelpfulLinks?this._oPopoverHelpfulLinks.openBy(e.getSource()):(this._oPopoverHelpfulLinks=sap.ui.xmlfragment("com.sap.dinesh.covid19india.dashboard.view.HelpFullinks",this),this.getView().addDependent(this._oPopoverHelpfulLinks),this._oPopoverHelpfulLinks.openBy(e.getSource()))},openMap:function(e){this.getView().getModel("appView").setProperty("/busy",!0),this.getRouter().navTo("map")}})});
